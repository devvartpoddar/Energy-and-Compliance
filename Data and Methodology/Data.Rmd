---
title: "Data and Methodology"
author: "Emma Heffernan and Devvart Poddar"
date: "11 November 2016"
output: pdf_document
  toc: true
---

\pagebreak

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/home/devvart/Desktop/Energy-and-Compliance")

rm(list = ls())
pkgs <- c("dplyr", "magrittr", "methods", "rvest", "stringi", "rio", "ggplot2",
  "tm", "wordcloud", "viridis", "pdftools", "xml2", "EIAdata", "lubridate", "stargazer", "knitr")

load <- sapply(pkgs, function(x) {
    suppressPackageStartupMessages(
      require(x, character.only = TRUE)
    )
  }
)
rm(load, pkgs)

# # Settng working directory
# try(setwd("/home/devvart/Desktop/Energy-and-Compliance"))
```

```{r downloading, echo = FALSE, cache = 3}
#source("R Scripts/file-scrape.R")
```

# Introduction

This paper aims to fill the gap in analysis conducted in the electricity pricing literature on the link between individual state implementation of Renewable Portfolio Standards (RPS) and electricity cost in the United States. In brief, the dominant argument states that requiring utilities to use more expensive renewable energy will drive up the cost of electricity for residents. Though this link has been replicated across studies, none of these studies have attempted to measure whether the state’s judicial bodies enforce RPS when confronted with utilities that do not adhere to these required standards. In other words, are there differences in the way that compliance is enforced in specific states?

This paper will perform an introductory analysis of the data related to this question in two parts. First, we will download the residential retail electricity prices of each state by month from 2001-2016. This data is available on eia.gov.
 
Second, this paper will download the year that RPS was implemented in each state. Specifically, the data will contain the binding year, the enactment year, and the effective year so that the relationship can control for lags in implementation. Then, this data will be combined with the retail electricity price data.

The states that have implemented an RPS policy are outlined in the following table;

```{r cars, echo = FALSE}
states.csv <- import("Input/processed/states.csv")

kable(states.csv)
```

These states will be contrasted against the electricity pricing of states that do not have RPS standards. In the final analysis, we will control for temperature, deregulation, and inflation, but that is beyond the scope of the present analysis.

Third, each states’ downloaded judicial court decisions will be used to assess how compliance is enforced in each state. A detailed analysis of these textual documents is beyond the scope of this assignment, but will be provided in the final analyses.

# Electricity Prices and RPS

## Electricity Prices
The first task is to collect the data on electricity prices and RPS year implementations for each state. The data was collected from the US Department of Energy from 2001 to 2009. Second, the data on when various states implemented RPS was available on the dsirea website. These variables were “scraped” from the internet, and were condensed into a single dataset.

We plot the residential electricity prices to better understand their distribution. As can be seen in the figure below, they are highly skewed and may vary due to several features.

```{r pressure, echo=FALSE, cache=2}
source("R Scripts/EIA-data.R")

data2 <- final.data %>%
  summarise(x = 1.1 * mean(Prices)) %>%
  mutate(y = 22,
         label= "Mean Price")

ggplot(final.data) +
  geom_histogram(aes(Prices), bins = 25) +
  geom_linerange(aes(x = mean(Prices), ymin = 0, ymax = 24),
                 colour = "#B22222", alpha = 0.7) +
  geom_text(data = data2, aes(x = x, y = y, label = label)) +
  labs(x = "Distribution of Prices")  +
  theme_bw() +
  theme(
    axis.title.y = element_blank()
  )
```

## RPS

After, the data on the years that RPS was implemented in each state was obtained from the Hongbo Wang (2016)’s paper on RPS and electricity prices. Her data was originally obtained from dsirea.

# Judicial decisions

We also scrape the judicial decisions published on the EIA website. Note that this is without the appellate rulings. In total we get 303 decisions which are in either pdf or doc format. Also note that the rulings have not been published to Github due to data size contraints. But one can view all the textual data derived. We visualise the frequency of the rulings;

``` {r judicialdecisions, echo = FALSE, cache=3}
source("R Scripts/pdf-clean.R")
```
``` {r judicialdecisions1, echo = FALSE, cache=3}
text.data %>%
  filter(year > 2005) %>%
  group_by(year) %>%
  dplyr::summarise(freq = n()) %>%
  ggplot() +
  geom_bar(aes(x = as.factor(year), y = freq), stat = "identity") +
  #scale_x_discrete() +
  labs(x = "Year", y = "Frequency of Judicial Decisions") +
  theme_bw()
```

Judicial decisions spike post 2012 in our dataset. This is also led by the growth of e-governments and the spike in distribution of information through open-data forums. It is also important to note that our dataset contains judicial rulings pre 2005, but are not visualised due to aesthetic considerations.

We also create wordclouds to figure out what is changing in the discussion. The word clouds for **2014** and **2016** are visualised respectively

``` {r wordcloud, echo = FALSE, cache = 3}
source("R Scripts/word-cloud.R")
```
``` {r wordcloud1, echo = FALSE, cache = 3}
par(mfrow=c(1,2))
wordcloud.make(freq2014)
wordcloud.make(freq2016)
```

Wordclouds of the two years help understand the need of measuring compliance of the rulings further. "Cost" or "Costs" are amongst the most frequent words in both the years. As are words like "order". Thus it lends credence to our theory that compliance with judicial rulings create exogenous costs for the industry, driving the prices upwards.

# Prices and Judicial Decisions

Finally we try to undestand the relationsip betweel energy prices and the implementation of RPS. We expect the implementation to have raised costs for energy firms, and thereby the prices. We also expect the prices to rise with greater frequency of judicial rulings, using the frequency as a poor cousin for the complexity of compliance. The results are summarised in the table below;

```{r regression, echo = FALSE, cache = 3}
final.data <- import("Output/processed data/EIA-data.csv")

frq.data <- import("Output/processed data/pdf-text.json") %>%
  group_by(year) %>%
  dplyr::summarise(Freq = n()) %>%
  merge(final.data)

reg.model <- lm(Prices ~ RPS + Freq, frq.data)
```
```{r stargazer}
stargazer(reg.model,
          covariate.labels = c("RPS", "Frequency of Judicial Decisions"),
          header = FALSE,
          title = "Determinants of Residential Electricity Prices",
          dep.var.labels.include = FALSE)
```

As the table above notes, both of our initial hypothesis are proven correct. RPS increased prices by 3.346 units where they were implemented. Increased frequency of judicial rulings also increased the average monthly prices, though the impact was much smaller. 

However these results have to be taen with a pinch of salt. We do not control for the complexity of compliance with the rulings, nor do we control for state wide effects. All these are issues we will address in the final paper.

# Conclusion

Our initial analysis is not as complex as our final analysis will be. Namely, we will explore whether judicial court enforcements of compliance differed across the states in terms of both the number of cases brought to the courts (as controlled for by number of utilities), the punishments allotted out to different utilities, as well as more sophisticated textual analysis that will include grammar, and word choices. Going forward, we will analyse whether the divergence can be linked to enforced compliance standards.